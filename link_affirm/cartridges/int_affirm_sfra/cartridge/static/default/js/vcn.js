$(function(){$(document).on("click",".place-order",function(a){if("Affirm"!==$(".payment-information").data("payment-method-id"))return!0;if(!$("#vcn-data").data("affirmselected")||window.vcn_approved)return!0;var b=$("#vcn-data").data("vcndata");if($("#vcn-data").data("enabled")){var c=$(this);$("#vcn-data").data("vcncomplete","true"),a.preventDefault(),delete b.metadata.mode,affirm.checkout.open_vcn({success:function(a){$.ajax({url:$("#vcn-data").data("updateurl")+"?"+$("#vcn-data").data("csrfname")+"="+$("#vcn-data").data("csrftoken"),data:a,dataType:"json",method:"POST",success:function(a){a.error?$("div.error-form").length?$("div.error-form").text($("#vcn-data").data("errormessages").default):$("table.item-list").before("<div class='error-form'>"+$("#vcn-data").data("errormessages").default+"</div>"):(window.vcn_approved=!0,c.click())},error:function(a){$("table.item-list").before('<div class="error-form">Error in establishing connection with Affirm VCN service!</div>')},done:function(){console.log("done")}})},error:function(a){if("canceled"==a.reason||"closed"==a.reason)return void window.location.assign($("#vcn-data").data("errorurl"));var b="",c=$("#vcn-data").data("errormessages");b=c[a.reason]||c.default,$("div.error-form").length?$("div.error-form").text(b):$("table.item-list").before("<div class='error-form'>"+b+"</div>")},checkout_data:b})}else"modal"==b.metadata.mode?(a.preventDefault(),affirm.checkout(b),affirm.checkout.open({onFail:function(a){window.location.assign(b.merchant.user_cancel_url)},onSuccess:function(a){var c=$("#vcn-data").data("csrfname")+"="+$("#vcn-data").data("csrftoken"),d=b.merchant.user_confirmation_url+"?checkout_token="+a.checkout_token+"&"+c;window.location.assign(d)}})):(a.preventDefault(),affirm.checkout(b),affirm.checkout.post())}),$(document).on("product:afterAttributeSelect",function(a,b){var c=null,d=b.data.product;d.price.sales?c=d.price.sales.value:d.price.list?c=d.price.list.value:d.price.startingFromPrice&&(c=d.price.startingFromPrice.sales.value),$(".affirm-as-low-as").attr("data-amount",(100*c).toFixed()),affirm.ui.refresh()}),$(document).on("checkout:updateCheckoutView",function(a,b){$(".affirm-product-modal").attr("data-amount",(100*b.order.totals.grandTotal.substr(1)).toFixed()),affirm.ui.refresh()}),affirm.ui.ready(function(){affirm.ui.error.on("close",function(){window.location.replace($("#vcn-data").data("errorurl"))})})});